<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Rust WASM Snake</title>
    <style>
      body {
        background: black;
        color: white;
        margin: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
      }
      #container { text-align: center; }
      canvas { background: #111; margin: 20px auto; display: block; touch-action:none; border: 2px solid white; }
      #score { margin-top: 10px; }
    </style>
  </head>
  <body>
    <div id="container">
      <div id="score">Score: 0</div>
      <canvas id="game"></canvas>
      <div>
        <button id="mode">Switch to 3D</button>
        <button id="restart" style="display:none;">Restart</button>
      </div>
    </div>
    <script type="module">
      import init, * as wasm from "./pkg/snake_game.js";
      init().then(() => {
        const mode = document.getElementById("mode");
        mode.addEventListener("click", () => wasm.toggle_mode());
        document
          .getElementById("restart")
          .addEventListener("click", () => wasm.restart());

        const canvas = document.getElementById("game");
        let start = null;
        const dispatch = (key) =>
          document.dispatchEvent(new KeyboardEvent("keydown", { key }));

        canvas.addEventListener(
          "touchstart",
          (e) => {
            start = e.touches[0];
            e.preventDefault();
          },
          { passive: false }
        );
        canvas.addEventListener(
          "touchmove",
          (e) => e.preventDefault(),
          { passive: false }
        );
        canvas.addEventListener(
          "touchend",
          (e) => {
            if (!start) return;
            const dx = e.changedTouches[0].clientX - start.clientX;
            const dy = e.changedTouches[0].clientY - start.clientY;
            if (Math.abs(dx) > Math.abs(dy)) {
              if (dx > 30) dispatch("ArrowRight");
              else if (dx < -30) dispatch("ArrowLeft");
            } else {
              if (dy > 30) dispatch("ArrowDown");
              else if (dy < -30) dispatch("ArrowUp");
            }
            start = null;
            e.preventDefault();
          },
          { passive: false }
        );
      });
    </script>
  </body>
</html>
